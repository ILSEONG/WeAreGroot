<?xml version="1.0" encoding="UTF-8"?>
	<!DOCTYPE mapper
	  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.moran.comment">
	<select id="SelectCommentBybId" parameterType="int" resultType="kr.co.moran.web.vo.CommentVO">
		SELECT c_id as cId, b_id as bId, m_id as mId, c_parent_id as cParentId,
				c_contents as contents, c_like_cnt as likeCnt
		FROM COMMENT
		WHERE b_id = #{bId}
	</select>


	<insert id="InsertComment" parameterType="kr.co.moran.web.vo.CommentVO">
		INSERT INTO COMMENT (b_id c_contents, c_like_cnt, c_parent_id, c_regdate, m_id) VALUES
		(#{bId}, #{contents}, 0, NULL, NOW(), #{mId} )
	</insert>
	
	<update id="ModifyComment" >
		UPDATE COMMENT
		SET c_contents = #{contents}
		WHERE c_id = #{cId}
	</update>
	
	<update id="ModifyCommentLikeCntBycId" parameterType="int">
		UPDATE COMMENT
		SET c_like_cnt = c_like_cnt + 1
		WHERE c_id = #{cId}
	</update>
	
	<delete id="DeleteComment">
		DELETE FROM COMMENT WHERE c_id = #{cId}
	</delete>
	
	<!-- 이벤트 댓글조회 -->
	<select id="SelectCommentByEid" parameterType="int" resultType="java.util.HashMap">
		SELECT 
			c.c_id as cId, 
			c.e_id as eId, 
			c.m_id as mId,
			m.m_nick as nick, 
			c.c_parent_id as cParentId,
			c.c_contents as contents, 
			c.c_like_cnt as likeCnt,
			c.c_regdate as regDate
		FROM
			COMMENT AS c
		INNER JOIN
			MEMBER AS m ON c.m_id = m.m_id
		WHERE
			c.e_id = #{eId}
	</select>
	
	
	<insert id="InsertCommentByAny" parameterType="kr.co.moran.web.vo.CommentVO">
		INSERT INTO COMMENT (m_id, b_id, e_id, c_parent_id, c_contents, c_like_cnt ,c_regdate)
		VALUES (
		#{mId},
		<if test="bId != 0">#{bId}</if>
		<if test="bId == 0">null</if>,
		<if test="eId != 0">#{eId}</if>
		<if test="eId == 0">null</if>,
		<if test="cParentId != 0">#{cParentId}</if>
		<if test="cParentId == 0">null</if>,
		#{contents},
		0,
		now()
		)
	</insert>
	
	<!-- 댓글의 댓글등록 -->
	<insert id="InsertReComment" parameterType="kr.co.moran.web.vo.CommentVO" >
		INSERT INTO COMMENT (m_id, b_id, e_id, c_parent_id, c_contents, c_regdate)
		VALUES (#{mId}, #{bId}, #{eId}, #{cParentId}, #{contents}, now())
	</insert>
	
</mapper>